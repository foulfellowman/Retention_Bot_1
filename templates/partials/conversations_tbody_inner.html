{% for c in conversations %}
    {% set raw_status = (c.status or 'None')|trim %}
    {% set status_upper = raw_status.upper() %}
    {% set status_map = {
      'DONE': 'status-badge--success',
      'NONE': 'status-badge--neutral',
      'START': 'status-badge--neutral',
      'FOLLOW_UP': 'status-badge--danger'
    } %}
    {% set status_class = status_map.get(status_upper, 'status-badge--warning') %}
    {% set status_text = raw_status %}
    <tr hx-get="/conversations/{{ c.phone_number }}"
        hx-target="#chat-pane"
        hx-include="#search, #conversations-state"
        hx-on="click: document.querySelectorAll('#conversations-body tr').forEach(e => e.classList.remove('active')); this.classList.add('active'); document.getElementById('current-selected-phone').value='{{ c.phone_number }}'"
        class="{% if c.phone_number == selected_phone %}active{% endif %}">
      <td>
        <span class="conversation-name">
          {% if c.was_interested %}
            <span class="interested-indicator" title="Previously showed interest" aria-hidden="true"></span>
          {% endif %}
          {{ c.display_name or 'Unknown' }}
        </span>
      </td>
      <td>
        <span class="conversation-phone">
          {% if status_upper == 'STOP' %}
            <span class="stop-indicator" title="Messaging stopped" aria-hidden="true"></span>
          {% endif %}
          {{ c.phone_number }}
        </span>
      </td>
      <td>
        <span class="status-badge {{ status_class }}">{{ status_text }}</span>
      </td>
      <td>
        <button class="edit-btn"
                aria-label="Edit conversation"
                hx-get="/conversations/{{ c.phone_number }}/edit"
                hx-target="#modal-container"
                hx-swap="innerHTML">
          <img src="{{ url_for('static', filename='edit.png') }}" alt="" aria-hidden="true">
        </button>
      </td>
    </tr>
{% endfor %}

{% if not conversations %}
  <tr><td colspan="4">No conversations found</td></tr>
{% endif %}

